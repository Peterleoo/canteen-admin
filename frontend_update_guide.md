# 前端代码更新指南 - 将profiles表重命名为staffs表

## 一、更新背景
将原profiles表直接重命名为staffs表，作为后台员工表使用，同时保留之前创建的users表作为前台用户表。

## 二、已完成的更新

### 1. API代码更新
- ✅ `src/api/settings.ts` - 员工管理API已指向`staffs`表
- ✅ `src/api/user.ts` - 用户管理API已指向`users`表
- ✅ `src/api/order.ts` - 订单关联已从`profiles`改为`users`

### 2. 类型定义更新
- ✅ `src/types/index.ts` - Order接口中的`profiles`关联已改为`users`关联

### 3. 组件更新
- ✅ `src/pages/orders/OrderListPage.tsx` - 订单列表和详情中的用户信息显示已从`profiles`改为`users`

### 4. Mock数据更新
- ✅ `src/api/mock.ts` - Mock订单中的`profiles`字段已改为`users`字段，过滤逻辑已更新

## 三、需要确认的更新

### 1. 检查是否有其他地方引用了profiles表
```bash
# 在项目根目录运行以下命令，查找所有引用profiles的文件
grep -r "profiles" --include="*.ts" --include="*.tsx" --include="*.js" --include="*.jsx" src/
```

### 2. 检查数据库连接和配置
- 确认Supabase或其他数据库连接配置中没有硬编码profiles表名
- 检查是否有任何环境变量引用了profiles表名

### 3. 检查权限和角色配置
- 确认员工角色和权限配置仍然正确
- 检查是否有任何权限规则引用了profiles表名

## 四、测试步骤

### 1. 运行构建命令
```bash
npm run build
```

### 2. 运行开发服务器
```bash
npm run dev
```

### 3. 测试核心功能
- 登录后台管理系统
- 查看员工管理页面
- 查看用户管理页面
- 查看订单管理页面
- 创建新员工
- 创建新用户
- 创建新订单

## 五、回滚计划

如果更新过程中出现问题，可以使用以下步骤回滚：

1. 将staffs表重命名回profiles表
```sql
ALTER TABLE staffs RENAME TO profiles;
```

2. 将前端代码中所有staffs改回profiles

3. 运行构建命令确认回滚成功

## 六、注意事项

1. **数据安全**：在执行数据库操作前，建议备份当前数据
2. **兼容性**：确保所有前端代码和后端API都已正确更新
3. **测试覆盖**：确保所有核心功能都已测试通过
4. **文档更新**：更新相关文档，反映表名变更

## 七、更新完成确认

| 模块 | 状态 | 负责人 | 完成时间 |
|------|------|--------|----------|
| 数据库表重命名 | ✅ | - | - |
| API代码更新 | ✅ | - | - |
| 类型定义更新 | ✅ | - | - |
| 组件更新 | ✅ | - | - |
| Mock数据更新 | ✅ | - | - |
| 构建测试 | ✅ | - | - |
| 功能测试 | ⏳ | - | - |
| 文档更新 | ✅ | - | - |

## 八、后续建议

1. 考虑添加数据迁移脚本，便于后续表结构变更
2. 建议使用ORM或查询构建器，减少硬编码表名
3. 定期检查代码中是否有硬编码的表名和字段名

---

**更新日期**：2026-01-12  
**更新人**：系统管理员  
**版本**：v1.0